// app/views/datafiles/create_from_box.js.haml
:plain

  var row = '<td><div class = "row"><span class="col-md-8">' + "#{@filename}" + '</span><span class="col-md-2">' + "#{@filesize_display}" + '</span><span class="col-md-2"><a data-confirm="Are you sure?" class="btn btn-danger btn-sm" rel="nofollow" data-method="delete" href="/datafiles/' + "#{@datafile.web_id}" + '"><span class="glyphicon glyphicon-trash"></span> File</a></span></span></div></td>';

  $("#datafiles > tbody:last-child").append("<tr id='" + "job#{@job.id}" + "'></tr>");

  var interval;
  $('.export .well').show();
  interval = setInterval(function(){
    $.ajax({
      url: '/progress-job/' + #{@job.id},
      success: function(job){

        //console.log(job)
        var stage, progress;

        // If there are errors
        if (job.last_error != null) {
          $('.progress-status').addClass('text-danger').text(job.progress_stage);
          $('.progress-bar').addClass('progress-bar-danger');
          $('.progress').removeClass('active');
          clearInterval(interval);
        }

        progress = job.progress_current / job.progress_max * 100;
        // In job stage
        if (progress.toString() !== 'NaN'){
          $('.progress-status').text(job.progress_current + '/' + job.progress_max);
          $('.progress-bar').css('width', progress + '%').text(progress + '%');
        }
      },
      error: function(){
        // Job is no loger in database which means it finished successfuly
        $('.progress').removeClass('active');
        $('.progress-bar').css('width', '100%').text('100%');
        $('.progress-status').text('Successfully imported!');
        $('.export-link').show();

        clearInterval(interval);

        $("#job#{@job.id}").html(row);
      }
    })
  },100);