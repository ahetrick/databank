<div class="row">
  <div class="col-md-3">
    <h1>Datasets</h1>
  </div>
  <div class="col-md-3">
    <%= will_paginate @datasets %>
  </div>
    <div class="form-group">
      <form class="navbar-form" role="search">
        <input name="utf8" type="hidden" value="âœ“">
        <div class="pull-right">

          <% if can? :create, Dataset %>
            <input name="current_user_email" type="hidden"  id="current_user_email" value="<%= current_user.email  %>">
            <button type="button" class="btn btn-sm btn-primary <%= params[:depositor_email] ? '' : 'selected-button' %>" id="show-all-button">All</button>
            <button type="button" class="btn btn-sm btn-primary <%= params[:depositor_email] ? 'selected-button' : '' %>" id="show-my-button"  >My Saved Datasets</button>
         <% end %>
        <div class="input-group">
          <input type="text" class="form-control search" placeholder="Search Datasets" name="search" id="search" <% if params[:search] %>value="<%= params[:search] %>" <% end %>>
          <div class="input-group-btn">
            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
          </div>
        </div>
        </div>
      </form>
    </div>
</div>

<% @datasets.each do |dataset| %>
  <% if ((can? :update, dataset) || dataset.complete?) %>
    <hr/>
    <div class="row">
      <span class="col-md-9">
        <% (dataset.identifier && !dataset.identifier.empty?) ? doi_part = "doi:#{dataset.identifier}" : doi_part = "" %>
        <%= link_to "#{dataset.creator_list} (#{dataset.publication_year}): #{dataset.title}. #{dataset.publisher}. #{doi_part}", dataset_path(dataset.key) %>
        <br />
        <% if dataset.description && !dataset.description.empty? %>
          <%= dataset.description.first(230) %><%if dataset.description.length > 230 %>[...]<%end%><br />
        <% end %>
        <% if dataset.keywords && !dataset.keywords.empty? %>
          <span class="metadata-label">Keyword(s): </span><%= dataset.keywords %>
        <% end %>
      </span>

      <span class="col-md-3">

        <%= link_to dataset_path(dataset.key), :class => "btn btn-primary btn-sm" do %>
          <span class="glyphicon glyphicon-zoom-in"></span> View
        <% end %>

        <% if can? :update, dataset %>
          <%= link_to edit_dataset_path(dataset.key), :class => "btn btn-info btn-sm" do %>
            <span class="glyphicon glyphicon-edit"></span> Edit
          <% end %>
        <% end %>

        <% if (((can? :destroy, dataset) && (!dataset.complete?))||(can? :manage, dataset) )%>
          <%= link_to dataset_path(dataset.key), method: :delete, data: {confirm: 'Are you sure?'}, :class => "btn btn-danger btn-sm" do %>
            <span class="glyphicon glyphicon-trash"></span> Delete
          <% end %>
        <% end %>

      </span>
    </div>

  <% end %>
<% end %>
<hr/>
<% if can? :create, Dataset %>
  <%= link_to 'New Dataset', new_dataset_path %>
<% end %>