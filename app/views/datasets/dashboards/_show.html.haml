- if (can? :edit, @dataset)
  .idb-dashboard.panel.panel-warning
    -#.panel-heading
    -#  %span(class="metadata-label" )Dataset Dashboard
    .panel-body
      .row
        .col-md-9
          -if @dataset.has_datacite_change &&  [Databank::PublicationState::Embargo::FILE, Databank::PublicationState::RELEASED, Databank::PublicationState::PermSuppress::FILE].include?(@dataset.publication_state)
            .datacite-changes-warning
              %span(class="glyphicon glyphicon-alert" )
              Changes have been made to this dataset record that have not yet been published.  Confirm to complete changes.
          -if @dataset.publication_state == Databank::PublicationState::Embargo::METADATA && (@dataset.embargo != Databank::PublicationState::Embargo::METADATA)
            .datacite-changes-warning
              %span(class="glyphicon glyphicon-alert" )
              This dataset record has not yet been published.  Confirm to complete changes.

          -if @completion_check != 'ok'
            .completion-warning
              %span(class="glyphicon glyphicon-alert" )
              = @completion_check
              - if @dataset.publication_state == Databank::PublicationState::DRAFT || (can? :manage, @dataset)
                Edit to complete dataset.
          %span(class="glyphicon glyphicon-eye-open" )
          %span(class="metadata-label" ) Visibility:
          = @dataset.visibility
          %br
          %span(class="glyphicon glyphicon-info-sign")
          Research Data Service team members are available to discuss this dataset in more depth.
          %button(type="button" onclick='window.open("/help?context=review&key=#{@dataset.key}")' class="btn btn-success")
            %span(class="glyphicon glyphicon-question-sign")
            Request Dataset Consultation

        .col-md-3
          -# confirm button conditional complex, so broken into two statements
          -if @completion_check == 'ok' && (@dataset.publication_state == Databank::PublicationState::DRAFT || (@dataset.has_datacite_change && [Databank::PublicationState::RELEASED, Databank::PublicationState::Embargo::FILE, Databank::PublicationState::PermSuppress::FILE].include?(@dataset.publication_state) ) )
            %button(type="button" id="show-confirm-modal-link" class="btn btn-primary btn-block" data-toggle="modal" data-target="#deposit")
              Confirm
              %span(class="glyphicon glyphicon-triangle-right" )
          -if @dataset.publication_state == Databank::PublicationState::Embargo::METADATA && @dataset.embargo != Databank::PublicationState::Embargo::METADATA
            %button(type="button" id="show-confirm-modal-link" class="btn btn-primary btn-block" data-toggle="modal" data-target="#deposit")
              Confirm
              %span(class="glyphicon glyphicon-triangle-right" )
          = link_to(edit_dataset_path(@dataset), :class => "btn idb btn-info btn-block") do
            %span(class="glyphicon glyphicon-edit")
            Edit
          - if @dataset.publication_state == Databank::PublicationState::DRAFT
            = link_to(dataset_path(@dataset.key), method: :delete, data: {confirm: 'Are you sure? This removes all files and metadata.'}, class: "btn idb btn-danger btn-block") do
              %span(class="glyphicon glyphicon-trash" )
              Delete
          - else
            %button(type="button" class="btn btn-danger btn-block" name="cancel" onclick='window.location = "/"' )
              %span(class="glyphicon glyphicon-ban-circle" )
              Cancel

