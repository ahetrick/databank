- if (can? :edit, @dataset)
  .idb-dashboard.panel.panel-warning
    -#.panel-heading
    -#  %span(class="metadata-label" )Dataset Dashboard
    .panel-body
      .row
        .col-md-9
          - if @completion_check == 'ok'
            - if ((can? :manage, @dataset) && (@dataset.publication_state != Databank::PublicationState::DRAFT) && (@dataset.publication_state != Databank::PublicationState::Embargo::METADATA) && (@dataset.embargo == Databank::PublicationState::Embargo::METADATA))
              %span(class="glyphicon glyphicon-alert" )
              Embargo placeholders have not yet replaced DataCite metadata. Confirm to complete changes.
              %br
            -elsif @dataset.has_datacite_change &&  [Databank::PublicationState::Embargo::FILE, Databank::PublicationState::RELEASED, Databank::PublicationState::PermSuppress::FILE].include?(@dataset.publication_state)
              .datacite-changes-warning
                %span(class="glyphicon glyphicon-alert" )
                Changes have been made to this dataset record that have not yet been published.  Confirm to complete changes.
                %br
            -elsif @dataset.publication_state == Databank::PublicationState::Embargo::METADATA && (@dataset.embargo != Databank::PublicationState::Embargo::METADATA)
              .datacite-changes-warning
                %span(class="glyphicon glyphicon-alert" )
                This dataset record has not yet been published.  Confirm to complete changes.
                %br
          -else
            .completion-warning
              %span(class="glyphicon glyphicon-alert" )
              = @completion_check
              - if @dataset.publication_state == Databank::PublicationState::DRAFT || (can? :manage, @dataset)
                Edit to complete dataset.
                %br
          %span(class="glyphicon glyphicon-eye-open" )
          = @dataset.visibility
          %br
          %span(class="glyphicon glyphicon-info-sign")
          Research Data Service team members are available to discuss this dataset in more depth.
          %button(type="button" onclick='window.open("/help?context=review&key=#{@dataset.key}")' class="btn btn-success")
            %span(class="glyphicon glyphicon-question-sign")
            Request Dataset Consultation

        .col-md-3
          - if @completion_check == 'ok'
            -# confirm button conditional complex, so broken into three statements
            -if ((can? :manage, @dataset) && (@dataset.publication_state != Databank::PublicationState::DRAFT) && (@dataset.publication_state != Databank::PublicationState::Embargo::METADATA) && (@dataset.embargo == Databank::PublicationState::Embargo::METADATA))
              %button(type="button" id="show-confirm-modal-link" class="btn btn-primary btn-block" data-toggle="modal" data-target="#deposit")
                Confirm
                %span(class="glyphicon glyphicon-triangle-right" )
            -elsif (@completion_check == 'ok') && (@dataset.publication_state == Databank::PublicationState::DRAFT || (@dataset.has_datacite_change && [Databank::PublicationState::RELEASED, Databank::PublicationState::Embargo::FILE, Databank::PublicationState::PermSuppress::FILE].include?(@dataset.publication_state) ) )
              %button(type="button" id="show-confirm-modal-link" class="btn btn-primary btn-block" data-toggle="modal" data-target="#deposit")
                Confirm
                %span(class="glyphicon glyphicon-triangle-right" )
            -elsif @dataset.publication_state == Databank::PublicationState::Embargo::METADATA && @dataset.embargo != Databank::PublicationState::Embargo::METADATA
              %button(type="button" id="show-confirm-modal-link" class="btn btn-primary btn-block" data-toggle="modal" data-target="#deposit")
                Confirm
                %span(class="glyphicon glyphicon-triangle-right" )
          -else
            %button(type="button" id="show-confirm-modal-link" class="btn btn-default btn-block" data-toggle="modal" data-target="#incomplete")
              Confirm
              %span(class="glyphicon glyphicon-triangle-right" )
          = link_to(edit_dataset_path(@dataset), :class => "btn idb btn-success btn-block") do
            %span(class="glyphicon glyphicon-edit")
            Edit
          %button(type="button" class="btn btn-info btn-block" name="cancel" onclick='window.location = "/datasets?depositor=#{current_user.name}"' )
            %span(class="glyphicon glyphicon-pushpin" )
            Exit this Saved Dataset
          - if @dataset.publication_state == Databank::PublicationState::DRAFT
            = link_to(dataset_path(@dataset.key), method: :delete, data: {confirm: 'Are you sure? This removes all files and metadata.'}, class: "btn idb btn-danger btn-block") do
              %span(class="glyphicon glyphicon-trash" )
              Delete


